/*! jQuery.popLockIt - v0.1.0 - 2013-02-02
* https://github.com/zamiang/jquery.popLockIt
* Copyright (c) 2013 Brennan Moore; Licensed MIT */
(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};(function(t,r,i){var s,o,u,a,f;return f="popLockIt",s=function(){function e(e,t){var n,r,i,s;this.$el=e,this.settings=t,s=this.requires;for(r=0,i=s.length;r<i;r++){n=s[r];if(this.settings[n]==null)throw"You must pass "+n}}return e.prototype.requires=[],e}(),o=function(t){function r(t,n){this.$el=t,this.settings=n,this.setPosition=e(this.setPosition,this),this.setDimensions=e(this.setDimensions,this),this.setDimensions(n.height,n.marginTop,n.marginBottom,n.marginLeft),this}return n(r,t),r.prototype.requires=["height","marginTop","marginLeft","marginBottom"],r.prototype.cssProperties=["position","top","bottom","left"],r.prototype.marginTop=0,r.prototype.marginBottom=0,r.prototype.marginLeft=0,r.prototype.setDimensions=function(e,t,n,r){e&&(this.parentHeight=e),t&&(this.marginTop=t),n&&(this.marginBottom=n),r&&(this.marginLeft=r),this.height=Math.floor(Number(this.$el.css("height").replace("px",""))),this.top=Math.floor(this.$el.offset().top-this.marginTop),this.left=Math.floor(this.$el.offset().left),this.bottom=Math.floor(this.top+this.parentHeight-this.height);if(this.top<1)return this.top=1},r.prototype.setPosition=function(e,t){var n,r,i,s,o,u,a;e==null&&(e="absolute"),t==null&&(t="north"),i={position:e,top:t==="north"?this.marginTop:"auto",bottom:t==="south"?this.marginBottom:"auto",left:this.getLeftForPosition(e)};if(!this.oldState)return this.$el.css(i),this.oldState=i;r={},n=!1,a=this.cssProperties;for(o=0,u=a.length;o<u;o++)s=a[o],i[s]!==this.oldState[s]&&(r[s]=i[s],n=!0);if(n)return this.$el.css(r),this.oldState=i},r.prototype.getLeftForPosition=function(e){return e==="fixed"?this.left:e==="static"?0:this.left-(this.marginLeft||0)},r.prototype.onScroll=function(e,t,n){n==null&&(n=!1);if(!n&&e>=this.top&&e<this.bottom)return this.setPosition("fixed");if(e<this.top)return this.setPosition("absolute","north");if(e>=this.bottom)return this.setPosition("absolute","south")},r.prototype.destroy=function(){return this.setPosition()},r}(s),a=function(r){function i(t,n,r,s){this.$el=t,this.settings=n,this.index=r,this.parent=s,this.recomputeColumn=e(this.recomputeColumn,this),this.recompute=e(this.recompute,this),this.onScroll=e(this.onScroll,this),this.setDimensions=e(this.setDimensions,this),this.initialize=e(this.initialize,this),i.__super__.constructor.apply(this,arguments),this.$columns=this.$el.find(this.settings.columnSelector),this.initialize(),this.settings.additionalFeedItemInit&&this.settings.additionalFeedItemInit(this.$el,this.index),this}return n(i,r),i.prototype.requires=["columnSelector"],i.prototype.active=!1,i.prototype.initialize=function(){return this.setDimensions(),this.createColumns()},i.prototype.createColumns=function(){var e,n,r,i,s;if(this.$columns.length<2)return;e=this.height,n=this.left,i=this.marginTop,r=this.marginBottom;if(((s=this.$columns)!=null?s.length:void 0)>0)return this.columns=this.$columns.map(function(){return new o(t(this),{height:e,marginTop:i,marginBottom:r,marginLeft:n})})},i.prototype.setDimensions=function(){var e;if(this.$columns.length<2)return;return this.marginTop=Number(this.$el.css("padding-top").replace("px","")),this.marginBottom=Number(this.$el.css("padding-bottom").replace("px","")),this.resetColumnPositioning(),this.$el.css({height:"auto"}),e=this.$el.css("height"),this.height=Number(e.replace("px","")),this.$el.css({height:e}),this.left=this.$el.offset().left,this.top=this.$el.offset().top,this.bottom=this.top+this.height},i.prototype.resetColumnPositioning=function(){var e,t,n,r,i,s;if(((r=this.columns)!=null?r.length:void 0)>0){i=this.columns,s=[];for(t=0,n=i.length;t<n;t++)e=i[t],s.push(e.setPosition("static"));return s}return},i.prototype.onScroll=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v;if(!(((l=this.columns)!=null?l.length:void 0)>0))return;if(t>=this.height)return this.active=!1;if(e>=this.top&&e<this.bottom){this.active=!0,c=this.columns,d=[];for(i=0,u=c.length;i<u;i++)r=c[i],d.push(r.onScroll(e,t,this.parent.settings.preventFixed));return d}if(this.active){h=this.columns;for(s=0,a=h.length;s<a;s++)r=h[s],r.onScroll(e,t,!0);return this.active=!1}if(n){p=this.columns,v=[];for(o=0,f=p.length;o<f;o++)r=p[o],v.push(r.onScroll(e,t,!0));return v}},i.prototype.recompute=function(){var e,t,n,r,i,s;if(((r=this.columns)!=null?r.length:void 0)>0){this.setDimensions(),i=this.columns,s=[];for(t=0,n=i.length;t<n;t++)e=i[t],s.push(e.setDimensions(this.height,this.marginTop,this.marginBottom,this.left));return s}return},i.prototype.recomputeColumn=function(e){var t;if(((t=this.columns)!=null?t.length:void 0)>0){if(!this.columns[e])return this.columns[e].setDimensions(this.height,this.settings.marginTop,this.settings.marginBottom,this.left);return}return},i.prototype.destroy=function(){var e,t,n,r,i;r=this.columns,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.destroy());return i},i}(s),u=function(i){function s(n,i){var o;this.el=n,this.settings=i,this.addFeedItems=e(this.addFeedItems,this),this.start=e(this.start,this),this.stop=e(this.stop,this),this.destroy=e(this.destroy,this),this.recomputeItemColumn=e(this.recomputeItemColumn,this),this.recomputeItem=e(this.recomputeItem,this),this.$el=t(this.el);if(this.settings==null)throw"You must pass settings";if(((o=this.$el)!=null?o.length:void 0)!==1)throw"PopLockIt must be called on one element";s.__super__.constructor.call(this,this.$el,this.settings),this.$window=t(r),this.settings=t.extend(this.defaults,this.settings),this.settings.active=!0,this.initRequestAnimationFrame(),this.viewportHeight=this.$window.outerHeight(!0),this.$el.css({"box-sizing":"border-box",overflow:"hidden"}),this.addFeedItems(this.settings.feedItems),this.requestAnimationFrame(),this}return n(s,i),s.prototype.feedItems=[],s.prototype.requires=["feedItems"],s.prototype.hasFocus=!0,s.prototype.scrollSpeedThreshold=500,s.prototype.defaults={active:!0,rendered:!1,preventFixed:!1},s.prototype.onScroll=function(){var e,t,n,i,s,o=this;if(!this.settings.active)return;t=this.$window.scrollTop();if(t===this.previousScrollTop)return this.requestedAnimationFrame=r.requestAnimationFrame(function(){return o.onScroll()});s=this.feedItems;for(n=0,i=s.length;n<i;n++)e=s[n],e.onScroll(t,this.viewportHeight,Math.abs(t-this.previousScrollTop)>this.scrollSpeedThreshold);return this.previousScrollTop=t,this.settings.onScroll!=null&&this.settings.onScroll(t),this.requestAnimationFrame()},s.prototype.recompute=function(){var e,t,n,r,i,s,o,u,a,f;this.settings.active=!0,u=this.feedItems;for(r=0,s=u.length;r<s;r++)e=u[r],e.recompute();n=this.$window.scrollTop(),a=this.feedItems,f=[];for(i=0,o=a.length;i<o;i++)t=a[i],f.push(t.onScroll(n,this.viewportHeight,!1));return f},s.prototype.recomputeItem=function(e){if(!this.feedItems[e])return;return this.feedItems[e].recompute()},s.prototype.recomputeItemColumn=function(e,t){if(!this.feedItems[e])return;return this.feedItems[e].recomputeColumn(t)},s.prototype.destroy=function(){var e,n,r,i;this.settings.rendered=!1,this.settings.active=!1,t.data(this.$el,"plugin_"+f,!1);if(typeof feedItems!="undefined"&&feedItems!==null?feedItems.length:void 0){i=this.feedItems;for(n=0,r=i.length;n<r;n++)e=i[n],e.destroy()}return this.feedItems=[]},s.prototype.stop=function(){return this.settings.active=!1,r.cancelAnimationFrame(this.requestedAnimationFrame)},s.prototype.start=function(){var e=this;return this.settings.active=!0,r.cancelAnimationFrame(this.requestedAnimationFrame),this.requestedAnimationFrame=r.requestAnimationFrame(function(){return e.onScroll()})},s.prototype.addFeedItems=function(e){var n=this;if(e==null||!e.length)throw"You must pass $feedItems";return e.map(function(e,r){return n.feedItems.push(new a(t(r),n.settings,e,n))})},s.prototype.requestAnimationFrame=function(){var e=this;return this.requestedAnimationFrame=r.requestAnimationFrame(function(){return e.onScroll()})},s.prototype.debounce=function(e,t){var n;return n=0,function(){var r,i,s=this;return r=arguments,i=function(){return n=null,e(r)},clearTimeout(n),n=setTimeout(i,t)}},s.prototype.initRequestAnimationFrame=function(){var e,t,n,i,s;if(r.requestAnimationFrame)return;e=0,n=["ms","moz","webkit","o"];for(i=0,s=n.length;i<s;i++){t=n[i];if(!!r.requestAnimationFrame)continue;r.requestAnimationFrame=r[""+t+"RequestAnimationFrame"],r.cancelAnimationFrame=r["{vendor}CancelAnimationFrame"]||r["{vendors}CancelRequestAnimationFrame"]}r.requestAnimationFrame||(r.requestAnimationFrame=function(t,n){var i,s,o;return i=(new Date).getTime(),o=Math.max(0,16-(i-e)),s=r.setTimeout(function(){return t(i+o)},o),e=i+o,s});if(!r.cancelAnimationFrame)return r.cancelAnimationFrame=function(e){return clearTimeout(e)}},s}(s),t.fn[f]=function(e){if(!t.data(this,"plugin_"+f)){if(e==null)throw"You must pass settings";return t.data(this,"plugin_"+f,new u(this,e))}if(t.data(this,"plugin_"+f)[e]!=null)return t.data(this,"plugin_"+f)[e](Array.prototype.slice.call(arguments,1)[0],Array.prototype.slice.call(arguments,1)[1]);throw"Method '"+e+"' does not exist on jQuery.popLockIt"}})(jQuery,window,document)}).call(this);